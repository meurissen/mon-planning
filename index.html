<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Planner Pro Famille v6</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png">
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --warning: #f39c12; --danger: #e74c3c; --bg: #f5f6fa; --dark: #2c3e50; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: env(safe-area-inset-top) 15px 100px 15px; color: var(--dark); -webkit-user-select: none; }
        h1 { text-align: center; font-size: 20px; margin: 15px 0; }
        
        .date-nav { display: flex; align-items: center; justify-content: space-between; background: white; padding: 10px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .date-nav button { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; font-size: 18px; cursor: pointer; }
        .date-nav input { border: none; font-size: 16px; font-weight: bold; text-align: center; width: 140px; background: transparent; }

        .card { background: white; border-radius: 18px; padding: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .label { font-size: 10px; font-weight: 800; color: #bdc3c7; margin-bottom: 5px; text-transform: uppercase; margin-top: 10px; }
        input[type="text"], input[type="time"], input[type="number"] { width: 100%; border: none; border-bottom: 2px solid #f1f2f6; padding: 8px 0; margin-bottom: 5px; font-size: 16px; outline: none; }
        .row { display: flex; gap: 10px; }
        .row > div { flex: 1; }
        
        .selection-grid { display: flex; overflow-x: auto; gap: 8px; padding: 5px 0; margin-bottom: 5px; -webkit-overflow-scrolling: touch; }
        .icon-item { padding: 10px; background: #f8f9fa; border-radius: 10px; font-size: 22px; border: 2px solid transparent; flex-shrink: 0; min-width: 40px; text-align: center; }
        .icon-item.selected { border-color: var(--primary); background: #e1f5fe; }
        
        .color-item { width: 32px; height: 32px; border-radius: 50%; border: 3px solid transparent; flex-shrink: 0; cursor: pointer; }
        .color-item.selected { border-color: #2c3e50; transform: scale(1.1); }

        .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; color: white; font-weight: bold; font-size: 15px; margin-top: 15px; cursor: pointer; }
        .btn-add { background: var(--success); }
        .btn-edit { background: var(--warning); }
        .btn-copy-day { background: var(--dark); margin-top: 5px; font-size: 12px; padding: 8px; }

        #banner { display: none; background: #2c3e50; color: white; padding: 12px; border-radius: 10px; text-align: center; margin-bottom: 10px; font-size: 13px; position: sticky; top: 10px; z-index: 100; }

        .task-card { display: flex; align-items: center; background: white; padding: 12px; border-radius: 15px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); border-left: 8px solid var(--primary); }
        .task-emoji { font-size: 24px; margin-right: 12px; }
        .task-info { flex: 1; }
        .task-title { font-weight: bold; margin: 0; font-size: 15px; }
        .task-departure { color: #e67e22; font-weight: bold; font-size: 13px; }
        .actions { display: flex; gap: 4px; }
        .actions button { background: none; border: none; font-size: 18px; padding: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Mon Planner Pro üöÄ</h1>

    <div id="banner"></div>

    <div class="date-nav">
        <button onclick="changeDate(-1)">‚Üê</button>
        <input type="date" id="dateInput" onchange="render()">
        <button onclick="changeDate(1)">‚Üí</button>
    </div>

    <div class="card">
        <div class="label">Activit√©</div>
        <input type="text" id="titleInput" placeholder="Nom...">
        <div class="row">
            <div><div class="label">Arriv√©e</div><input type="time" id="arrivalTime" value="09:00"></div>
            <div><div class="label">Trajet (min)</div><input type="number" id="durationTime" value="20"></div>
        </div>
        
        <div class="label">Ic√¥ne</div>
        <div class="selection-grid" id="iconGrid"></div>

        <div class="label">Couleur (Moi / Enfants)</div>
        <div class="selection-grid" id="colorGrid"></div>

        <button class="btn btn-add" id="mainBtn" onclick="saveTask()">PROGRAMMER</button>
        <button class="btn btn-copy-day" id="copyDayBtn" onclick="prepareCopy('day')">DUPLIQUER LA JOURN√âE</button>
    </div>

    <div id="taskList"></div>

    <script>
        let tasks = JSON.parse(localStorage.getItem('planner_v6_tasks')) || {};
        let selectedIcon = 'üíº';
        let selectedColor = '#3498db';
        let editingId = null;
        let copyMode = null;
        let dataToCopy = null;

        // Mise √† jour de la liste des ic√¥nes (M√©decin, Piscine, Famille ajout√©s)
        const icons = ['üíº', 'üè†', 'üöó', 'ü©∫', 'üèä', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', '‚öΩ', 'üèÉ', 'üõí', 'üéì', 'üçï', 'üß∏', 'üîß'];
        const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6', '#e67e22', '#1abc9c', '#34495e'];

        const dateInput = document.getElementById('dateInput');
        dateInput.value = new Date().toISOString().split('T')[0];

        function setupSelection() {
            const iGrid = document.getElementById('iconGrid');
            iGrid.innerHTML = '';
            icons.forEach(icon => {
                const div = document.createElement('div');
                div.className = `icon-item ${icon === selectedIcon ? 'selected' : ''}`;
                div.innerHTML = icon;
                div.onclick = () => { selectedIcon = icon; setupSelection(); };
                iGrid.appendChild(div);
            });

            const cGrid = document.getElementById('colorGrid');
            cGrid.innerHTML = '';
            colors.forEach(color => {
                const div = document.createElement('div');
                div.className = `color-item ${color === selectedColor ? 'selected' : ''}`;
                div.style.backgroundColor = color;
                div.onclick = () => { selectedColor = color; setupSelection(); };
                cGrid.appendChild(div);
            });
        }

        function changeDate(days) {
            let d = new Date(dateInput.value);
            d.setDate(d.getDate() + days);
            dateInput.value = d.toISOString().split('T')[0];
            render();
        }

        function calculateDeparture(arrival, duration) {
            let [h, m] = arrival.split(':').map(Number);
            let total = h * 60 + m - parseInt(duration || 0);
            if (total < 0) total += 1440;
            return `${Math.floor(total/60).toString().padStart(2,'0')}:${(total%60).toString().padStart(2,'0')}`;
        }

        function saveTask() {
            const date = dateInput.value;
            const title = document.getElementById('titleInput').value;
            if (!title) return;
            const departure = calculateDeparture(document.getElementById('arrivalTime').value, document.getElementById('durationTime').value);
            const taskData = { 
                id: editingId || Date.now(), 
                title, 
                arrival: document.getElementById('arrivalTime').value, 
                duration: document.getElementById('durationTime').value, 
                departure, 
                icon: selectedIcon,
                color: selectedColor 
            };
            if (!tasks[date]) tasks[date] = [];
            if (editingId) tasks[date] = tasks[date].map(t => t.id === editingId ? taskData : t);
            else tasks[date].push(taskData);
            tasks[date].sort((a, b) => a.departure.localeCompare(b.departure));
            localStorage.setItem('planner_v6_tasks', JSON.stringify(tasks));
            resetForm(); render();
        }

        function resetForm() {
            editingId = null; document.getElementById('titleInput').value = '';
            document.getElementById('mainBtn').innerText = "PROGRAMMER";
            document.getElementById('mainBtn').className = "btn btn-add";
        }

        function editTask(id) {
            const date = dateInput.value;
            const task = tasks[date].find(t => t.id === id);
            editingId = id;
            document.getElementById('titleInput').value = task.title;
            document.getElementById('arrivalTime').value = task.arrival;
            document.getElementById('durationTime').value = task.duration;
            selectedIcon = task.icon; selectedColor = task.color || '#3498db';
            setupSelection();
            document.getElementById('mainBtn').innerText = "MODIFIER";
            document.getElementById('mainBtn').className = "btn btn-edit";
            window.scrollTo(0,0);
        }

        function prepareCopy(mode, taskData = null) {
            copyMode = mode;
            if (mode === 'day') {
                const date = dateInput.value;
                if (!tasks[date] || tasks[date].length === 0) return;
                dataToCopy = [...tasks[date]];
                document.getElementById('banner').innerHTML = "üìã Journ√©e copi√©e ! Changez de date.";
            } else {
                dataToCopy = {...taskData};
                document.getElementById('banner').innerHTML = `üìã "${taskData.title}" copi√© !`;
            }
            document.getElementById('banner').style.display = 'block';
        }

        function deleteTask(date, id) {
            tasks[date] = tasks[date].filter(t => t.id !== id);
            localStorage.setItem('planner_v6_tasks', JSON.stringify(tasks));
            render();
        }

        function render() {
            const date = dateInput.value;
            const banner = document.getElementById('banner');
            if (dataToCopy) {
                if (copyMode === 'day') tasks[date] = dataToCopy.map(t => ({...t, id: Math.random()}));
                else { if (!tasks[date]) tasks[date] = []; tasks[date].push({...dataToCopy, id: Math.random()}); }
                tasks[date].sort((a, b) => a.departure.localeCompare(b.departure));
                localStorage.setItem('planner_v6_tasks', JSON.stringify(tasks));
                dataToCopy = null; banner.style.display = 'none';
            }
            const container = document.getElementById('taskList');
            container.innerHTML = `<div style="font-weight:bold; color:#7f8c8d; margin-bottom:10px; text-transform:capitalize;">${new Date(date).toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'})}</div>`;
            const dayTasks = tasks[date] || [];
            document.getElementById('copyDayBtn').style.display = dayTasks.length > 0 ? 'block' : 'none';
            dayTasks.forEach(task => {
                container.innerHTML += `
                    <div class="task-card" style="border-left-color: ${task.color || '#3498db'}">
                        <div class="task-emoji">${task.icon}</div>
                        <div class="task-info">
                            <p class="task-title">${task.title}</p>
                            <div class="task-departure">üöó D√©part : ${task.departure}</div>
                        </div>
                        <div class="actions">
                            <button onclick='prepareCopy("task", ${JSON.stringify(task)})'>üìã</button>
                            <button onclick="editTask(${task.id})">‚úèÔ∏è</button>
                            <button onclick="deleteTask('${date}', ${task.id})">üóëÔ∏è</button>
                        </div>
                    </div>`;
            });
        }
        setupSelection(); render();
    </script>
</body>
</html>
